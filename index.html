<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DepEd Class Schedule Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root { color-scheme: light; }
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
    .modal { transition: opacity .3s ease-in-out, visibility .3s ease-in-out; }
    .modal.hidden { opacity: 0; visibility: hidden; }
    .modal.visible { opacity: 1; visibility: visible; }

    /* Sticky first column in schedule tables */
    .sticky-col { position: sticky; left: 0; z-index: 10; background: white; }
    thead .sticky-col { z-index: 20; }

    /* Simple fade for views */
    .fade-in { animation: fade .25s ease-out both; }
    @keyframes fade { from { opacity: .0; transform: translateY(4px);} to { opacity: 1; transform: translateY(0);} }

    /* Custom scrollbar for better visibility */
    ::-webkit-scrollbar { width: 10px; height: 10px; }
    ::-webkit-scrollbar-track { background: #e2e8f0; }
    ::-webkit-scrollbar-thumb { background-color: #94a3b8; border-radius: 5px; border: 2px solid #e2e8f0; }
    ::-webkit-scrollbar-thumb:hover { background-color: #64748b; }
  </style>
</head>
<body class="p-6 md:p-10">

  <!-- Main View -->
  <div id="mainView" class="container mx-auto fade-in">
    <header class="text-center mb-10">
      <h1 class="text-3xl md:text-4xl font-bold text-slate-800">DepEd Class Schedule Generator</h1>
      <p class="text-slate-500 mt-2">Create and view schedules for multiple teachers.</p>
    </header>

    <div class="bg-white shadow-xl rounded-2xl p-6 md:p-10 mb-10">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-semibold text-slate-700">Teacher List</h2>
        <div class="flex space-x-2">
            <button id="addRowBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-full transition-colors duration-200 shadow-md">
                Add Teacher
            </button>
            <button id="importPasteBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-full transition-colors duration-200 shadow-md">
                Paste CSV
            </button>
        </div>
      </div>

      <!-- Table Section -->
      <div class="overflow-x-auto relative rounded-xl border border-gray-200">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subjects</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"></th>
            </tr>
          </thead>
          <tbody id="teacherTbody" class="bg-white divide-y divide-gray-200">
            <!-- Table rows will be inserted here by JavaScript -->
          </tbody>
        </table>
      </div>

      <div class="mt-6 hidden">
        <textarea id="teachersInput" rows="10" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="TeacherName;Subject1,Subject2,Subject3"></textarea>
      </div>
    </div>

    <div class="flex justify-center">
      <button id="generateBtn" class="bg-emerald-500 hover:bg-emerald-600 text-white text-lg font-bold py-3 px-8 rounded-full shadow-lg transform transition-transform duration-200 hover:scale-105">
        Generate Schedules
      </button>
    </div>
  </div>

  <!-- Schedule View -->
  <div id="scheduleView" class="container mx-auto hidden fade-in">
    <div class="flex items-center justify-between mb-6">
      <button id="backBtn" class="flex items-center text-blue-500 hover:text-blue-700 font-semibold transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
        </svg>
        Back to Teacher List
      </button>

      <div class="flex-grow flex justify-center mx-4">
          <select id="teacherSelector" class="form-select block w-full md:w-auto p-2 border-gray-300 rounded-lg shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
            <!-- Options populated by JS -->
          </select>
      </div>
      <div></div> <!-- Spacer -->
    </div>

    <div id="scheduleTableContainer" class="bg-white shadow-xl rounded-2xl p-4 md:p-6 overflow-x-auto relative">
      <!-- Schedule table will be inserted here by JavaScript -->
    </div>
  </div>

  <!-- Paste Modal -->
  <div id="pasteModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg p-6 w-full max-w-xl m-4 shadow-xl">
      <h3 class="text-xl font-semibold text-slate-800 mb-4">Paste Teacher Data (CSV)</h3>
      <textarea id="pasteArea" rows="8" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Paste data here, one teacher per line, e.g., &#10;Joe Bloggs;Math,Science&#10;Jane Doe;English,History,Art"></textarea>
      <div class="mt-4 flex justify-end space-x-2">
        <button id="cancelPasteBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-full transition-colors duration-200">Cancel</button>
        <button id="applyPasteBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-full transition-colors duration-200">Apply</button>
      </div>
    </div>
  </div>

  <!-- Message Modal (Toast) -->
  <div id="messageModal" class="modal fixed inset-0 flex items-end justify-center pointer-events-none hidden">
    <div id="toast" class="bg-slate-800 text-white py-3 px-6 rounded-lg shadow-lg mb-8 opacity-0 transform translate-y-4 transition-all duration-300 ease-in-out pointer-events-auto">
      <div id="messageText" class="flex items-center">
        <svg class="h-5 w-5 mr-2 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span>Message here.</span>
      </div>
    </div>
  </div>

  <script>
    const teachersInput = document.getElementById('teachersInput');
    const teacherTbody = document.getElementById('teacherTbody');
    const addRowBtn = document.getElementById('addRowBtn');
    const generateBtn = document.getElementById('generateBtn');
    const backBtn = document.getElementById('backBtn');
    const teacherSelector = document.getElementById('teacherSelector');
    const scheduleTableContainer = document.getElementById('scheduleTableContainer');
    const mainView = document.getElementById('mainView');
    const scheduleView = document.getElementById('scheduleView');
    const importPasteBtn = document.getElementById('importPasteBtn');
    const pasteModal = document.getElementById('pasteModal');
    const cancelPasteBtn = document.getElementById('cancelPasteBtn');
    const applyPasteBtn = document.getElementById('applyPasteBtn');
    const pasteArea = document.getElementById('pasteArea');
    const messageModal = document.getElementById('messageModal');
    const messageText = document.getElementById('messageText');
    const toastElement = document.getElementById('toast');

    let teachersData = {};
    let schedule = {};

    function toast(message, type = 'success') {
      const icons = {
        success: `<svg class="h-5 w-5 mr-2 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
        warning: `<svg class="h-5 w-5 mr-2 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856a2 2 0 001.905-2.738L13.916 4.262a2 2 0 00-3.832 0l-7.07 13.04a2 2 0 001.906 2.738z" /></svg>`,
        error: `<svg class="h-5 w-5 mr-2 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`
      };
      messageText.innerHTML = icons[type] + `<span>${message}</span>`;
      toastElement.style.backgroundColor = type === 'success' ? '#16a34a' : type === 'warning' ? '#f59e0b' : '#ef4444';
      messageModal.classList.remove('hidden');
      toastElement.classList.add('opacity-100', 'translate-y-0');
      setTimeout(() => {
        toastElement.classList.remove('opacity-100', 'translate-y-0');
        toastElement.classList.add('opacity-0', 'translate-y-4');
        setTimeout(() => messageModal.classList.add('hidden'), 300);
      }, 3000);
    }

    function generateSchedule() {
      schedule = {};
      const teachers = teachersInput.value.split('\n').filter(Boolean).map(line => {
        const [name, subjectsString] = line.split(';');
        if (!name || !subjectsString) return null;
        return { name: name.trim(), subjects: subjectsString.split(',').map(s => s.trim()) };
      }).filter(Boolean);

      teachersData = teachers.reduce((acc, t) => {
        acc[t.name] = t.subjects;
        return acc;
      }, {});

      if (teachers.length === 0) {
        toast('Please add at least one teacher.', 'warning');
        return;
      }

      const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
      const periods = Array.from({ length: 8 }, (_, i) => `P${i + 1}`);

      for (const teacher of teachers) {
        schedule[teacher.name] = {};
        for (const day of days) {
          schedule[teacher.name][day] = {};
          const assignedPeriods = new Set();
          const subjects = [...teacher.subjects];
          let subjectIndex = 0;

          // Simple assignment: distribute subjects across periods
          for (const period of periods) {
            if (subjectIndex < subjects.length) {
              schedule[teacher.name][day][period] = subjects[subjectIndex];
              subjectIndex++;
            } else {
              schedule[teacher.name][day][period] = 'Free';
            }
          }
        }
      }

      displayTeacherSelector(Object.keys(teachersData));
      showScheduleView();
      displaySelectedTeacherSchedule(Object.keys(teachersData)[0]);
      toast('Schedule generated successfully.', 'success');
    }

    function displayTeacherSelector(teacherNames) {
      teacherSelector.innerHTML = '';
      teacherNames.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        teacherSelector.appendChild(option);
      });
    }

    function displaySelectedTeacherSchedule(teacherName) {
      const currentSchedule = schedule[teacherName];
      if (!currentSchedule) return;

      const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
      const periods = ['P1', 'P2', 'P3', 'P4', 'P5', 'P6', 'P7', 'P8'];

      let tableHtml = `
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="sticky-col px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Period</th>
              ${days.map(day => `<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${day}</th>`).join('')}
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            ${periods.map(period => `
              <tr>
                <td class="sticky-col px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${period}</td>
                ${days.map(day => `
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${currentSchedule[day][period] || ''}</td>
                `).join('')}
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      scheduleTableContainer.innerHTML = tableHtml;
    }

    function tableToTextarea() {
      const rows = teacherTbody.querySelectorAll('tr');
      let data = [];
      rows.forEach(row => {
        const name = row.querySelector('.teacher-name').value;
        const subjects = row.querySelector('.teacher-subjects').value;
        if (name && subjects) {
          data.push(`${name};${subjects}`);
        }
      });
      teachersInput.value = data.join('\n');
    }

    function textareaToTable() {
      teacherTbody.innerHTML = '';
      const teachers = teachersInput.value.split('\n').filter(Boolean);
      teachers.forEach(line => {
        const [name, subjects] = line.split(';');
        if (name && subjects) {
          addTeacherRow(name, subjects);
        }
      });
      if (teachers.length === 0) {
        addTeacherRow();
      }
    }

    function addTeacherRow(name = '', subjects = '') {
      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="text" class="teacher-name w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Teacher Name" value="${name}">
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="text" class="teacher-subjects w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Subject1, Subject2" value="${subjects}">
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
          <button class="remove-row text-red-600 hover:text-red-900 font-semibold transition-colors duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.214 21H7.786A2 2 0 015.867 19.142L5 7m4 6h.01M15 6.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" />
              </svg>
          </button>
        </td>
      `;
      teacherTbody.appendChild(newRow);
      tableToTextarea();
    }

    function showMainView() {
      scheduleView.classList.add('hidden');
      scheduleView.classList.remove('fade-in');
      mainView.classList.remove('hidden');
      mainView.classList.add('fade-in');
    }

    function showScheduleView() {
      mainView.classList.add('hidden');
      mainView.classList.remove('fade-in');
      scheduleView.classList.remove('hidden');
      scheduleView.classList.add('fade-in');
    }

    function backToMainView() {
      showMainView();
      // On back, refresh the table from the textarea
      textareaToTable();
    }

    // Event listeners
    window.onload = () => {
      // Initialize with one empty row
      textareaToTable();
    };

    generateBtn.addEventListener('click', generateSchedule);
    teacherSelector.addEventListener('change', (e) => { const v = e.target.value; if (v) displaySelectedTeacherSchedule(v); });
    backBtn.addEventListener('click', backToMainView);

    // Teacher table actions
    addRowBtn.addEventListener('click', () => addTeacherRow());
    teacherTbody.addEventListener('click', (e) => {
      if (e.target.closest('.remove-row')) {
        e.target.closest('tr').remove();
        tableToTextarea();
      }
    });
    teacherTbody.addEventListener('change', tableToTextarea);
    teacherTbody.addEventListener('input', tableToTextarea);

    // Paste modal
    importPasteBtn.addEventListener('click', () => { pasteArea.value = ''; pasteModal.classList.remove('hidden'); pasteModal.classList.add('visible'); });
    cancelPasteBtn.addEventListener('click', () => { pasteModal.classList.remove('visible'); pasteModal.classList.add('hidden'); });
    applyPasteBtn.addEventListener('click', () => {
      const lines = pasteArea.value.split('\n').filter(Boolean);
      if (!lines.length) { toast('Nothing to add.', 'warning'); return; }
      lines.forEach(l => { teachersInput.value += (teachersInput.value ? '\n' : '') + l; });
      textareaToTable();
      toast('Pasted rows added.', 'success');
      pasteModal.classList.remove('visible'); pasteModal.classList.add('hidden');
    });

  </script>
</body>
</html>
